<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Warehouse Monitor - Bird's View</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Bảng điều khiển mới */
        #controls {
            position: absolute; top: 20px; left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px; border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            width: 320px; z-index: 100;
            max-height: 90vh; overflow-y: auto;
            display: flex; flex-direction: column; gap: 15px; /* Khoảng cách giữa các phần */
        }

        /* Tiêu đề chính */
        #controls h2.main-title {
            margin: 0; font-size: 20px; text-align: center; color: #333;
            border-bottom: 2px solid #eee; padding-bottom: 10px;
        }

        /* Các phần con (Section) */
        .control-section {
            border: 1px solid #eee; padding: 12px; border-radius: 8px; background: #fdfdfd;
        }
        .control-section h3 {
            margin: 0 0 10px 0; font-size: 16px; color: #555; font-weight: 600;
        }

        /* Phần 2: Bản đồ thu nhỏ (Overview) */
        #overview-map-container {
            width: 100%; height: 180px;
            background-color: #f0f0f0; border: 1px solid #ddd; border-radius: 4px;
            display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        #overview-canvas { width: 100%; height: 100%; object-fit: contain; }

        /* Phần 3: Bảng Tọa độ Tag */
        #tag-positions-table {
            width: 100%; border-collapse: collapse; font-size: 13px;
        }
        #tag-positions-table th, #tag-positions-table td {
            border: 1px solid #ddd; padding: 6px; text-align: center;
        }
        #tag-positions-table th { background-color: #f2f2f2; font-weight: 600; }
        .tag-row-empty { font-style: italic; color: #999; }

        /* Phần 4: Nút Lịch sử di chuyển */
        .history-controls {
            display: flex; gap: 8px;
        }
        .history-controls button {
            flex: 1; padding: 8px; cursor: pointer;
            background-color: #007bff; color: white;
            border: none; border-radius: 4px; font-size: 13px; font-weight: 500;
            transition: background 0.2s;
        }
        .history-controls button:hover { background-color: #0056b3; }
        .history-controls button.btn-secondary { background-color: #6c757d; }
        .history-controls button.btn-secondary:hover { background-color: #545b62; }

        /* Màn hình 3D */
        #scene-container { width: 100vw; height: 100vh; background: #1a1a1a; }
        
        /* Ẩn các phần tử không cần thiết */
        body > input, body > button { display: none; }
    </style>
    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" } }
    </script>
</head>
<body>

    <div id="controls">
        <h2 class="main-title">1. Chế độ xem (Bird's view 3D)</h2>
        
        <div class="control-section">
            <h3>2. Cấu hình kho (Overview)</h3>
            <div id="overview-map-container">
                <canvas id="overview-canvas" width="300" height="180"></canvas>
            </div>
            <div style="font-size: 12px; color: #666; margin-top: 5px; text-align: center;">
                Mặt bằng kho (XZ) - Anchor: Xanh, Tag: Đỏ
            </div>
        </div>

        <div class="control-section">
            <h3>3. Tọa độ Tag (Thời gian thực)</h3>
            <div style="max-height: 150px; overflow-y: auto;">
                <table id="tag-positions-table">
                    <thead>
                        <tr>
                            <th>Tag ID</th>
                            <th>X (m)</th>
                            <th>Y (Cao)</th>
                            <th>Z (m)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="tag-row-empty"><td colspan="4">Chưa có dữ liệu tag...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="control-section">
            <h3>4. Lịch sử di chuyển</h3>
            <div class="history-controls">
                <button id="btn-history-start" class="btn-secondary">Bắt đầu ghi</button>
                <button id="btn-history-end" class="btn-secondary">Kết thúc</button>
                <button id="btn-history-replay">Xem lại</button>
            </div>
        </div>
        
        <div id="status" style="font-size: 12px; margin-top:5px; color: #007bff; text-align: center;"></div>
    </div>
    
    <div id="scene-container"></div>
    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="client.js"></script>
</body>
</html>
